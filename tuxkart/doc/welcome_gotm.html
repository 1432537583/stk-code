<html>
<title>Tuxedo T. Penguin stars in TuxKart!</title>
<body BACKGROUND="background.png">
<table>
<tr>
<td>
<center>
<a href="http://sourceforge.net">
<img src="http://sourceforge.net/sflogo.php?group_id=2554&type=1" width="88" height="31" border="0"></a>
</center>
<p>
<center>
    <font SIZE=+7><b>T</b></font SIZE><b>UXEDO</b>
    <font SIZE=+7><b>T. P</b></font SIZE><b>ENGUIN STARS IN</b>

    <font SIZE=+7><b>T</b></font SIZE><b>UX</b><font SIZE=+7><b>K</b></font SIZE><b>ART!</b>
</center>
<br>
<center>by Steve and Oliver Baker</center>
</td>
<td>
<img SRC="title_screen.png">
</td>
</tr>
</table>

<H1>Welcome to TuxKart for GoTM'ers!</H1>

If you are reading this then TuxKart is the HappyPenguin
Game Of The Month - which means that a lot of people are
going to swoop down and work frantically on it for a month
or so.

<p>

This document is an effort to pass on a lot of knowledge in
a small space in order to get you guys up to speed as quickly
as possible.
<p>
I'll talk about CVS access, mailing lists, the structure of
TuxKart, the directory layout, the source code and the models.


<H1>Access to TuxKart.</H1>

TuxKart's home page, CVS repository and mailing lists are
on SourceForge at http://tuxkart.sf.net
<p>
All of the files are in the same repository.
<p>
Therefore, everyone who is planning to join in will need a
SourceForge account, let me know your account name and I'll
get you CVS access.
<p> 
You have to subscribe to the tuxkart-devel mailing list
in order to post there.  The list is no moderated.
<p> 
Run the 'reconf' script to set everything up right after a
CVS checkout...end users can just run './config ; make' as
always.
<p>
It may suprise you to learn that TuxKart is under 5500 lines
of code.  The reason for that brevity is that it uses a ton
of library code from the PLIB library (http://plib.sf.net).
Since PLIB is also one of my projects, we can make any changes
to it that make sense from a general perspective.
<p>
I doubt any of you guys will need to dink around inside PLIB,
but if you do, we'll get you developer access - and you'll
need to sign on to THAT mailing list too.
<p>
Aside from PLIB, TuxKart only needs OpenGL.  Keeping dependancies
to a minimum is "A Good Thing" !


<H1>Directory Layout:</H1>

In the repository, you'll find the following directories:
<p>
<TABLE border="1">
<TR>
<TD>
contrib
</TD>
<TD>
          An empty directory where I can hold contributions until
          I decide to add them into the build.  I don't think we'll
          want to use it for the GoTM process.
</TD>
</TR>

<TR>
<TD>
data
</TD>
<TD>
          The place where configuration files live.  There is one
          master file called 'levels.dat' that lists all of the
          racetracks in the game and another called 'players.dat'
          that lists which kart models are used for which players.
<p>
          levels.dat lists the base part of the filename of the
          track and the human-readable name.  We append '.drv'
          and '.loc' to the filename to get to the two config
          files that each track uses.
<p>
          The '.drv' file is a list of 2D coordinates that
          describe points along the track that the AI characters
          will try to follow.  It has a couple of other uses
          that I'll describe later.
<p>
          The '.loc' file contains the positions of all of the
          3D object that make up the track.  Generally, the
          first 3D object is the track itself, and the rest
          are decoration.  You also set up the collectibles
          and the choice of music for the level.
<p>
          There are better descriptions of all this in the 'doc'
          directory.
</TD>
</TR>

<TR>
<TD>
doc
</TD>
<TD>
          Yep - where the documents are.  These are also the
          web site - everything in here ends up on the TuxKart
          web site, so all documents are in HTML.
</TD>
</TR>

<TR>
<TD>
fonts
</TD>
<TD>
          TuxKart uses a little text.  It's rendered using the
          PLIB 'FNT' library which uses OpenGL to render the
          text.  This keeps it portable - but requires fonts
          in '.txf' format.  We have a tool to convert X fonts
          into TXF if needed.
</TD>
</TR>

<TR>
<TD>
images
</TD>
<TD>
          Contains all of the game textures, the splash screen,
          etc.  These are all in '.rgb' format - which is easy
          to load and supported by PLIB.  You can use GIMP, xv
          and most other image tools with '.rgb' files.
</TD>
</TR>

<TR>
<TD>
models
</TD>
<TD>
          These are in '.ac' format - as generated by the AC3D
          modeller.  Getting from 'blender' to '.ac' - or writing
          a '.blend' loader for PLIB is something we'll need to
          consider because AC3D is a non-free program.
</TD>
</TR>

<TR>
<TD>
mods
</TD>
<TD>
          Music is in '.mod' format - a sequencer-based format.
          I used 'funktrackergold' to dink with these.
</TD>
</TR>

<TR>
<TD>
src
</TD>
<TD>
         The source code.
</TD>
</TR>

<TR>
<TD>
wavs
</TD>
<TD>
        Sound effects are in '.wav' format.
</TD>
</TR>
</TABLE>
<p>
The configuration system is 'autoconf/automake'.

<H1>The TuxKart SourceCode:</H1>

<H3>start_tuxkart.cxx</H3>
The program starts off in 'main' (which is in 'start_tuxkart.cxx').
It draws the splash screen, sets up the GUI and has the PLIB
'PUI' GUI tool manage it.  When the user hits the START button,
control is transferred to the tuxkart_main() function in 'tuxkart.cxx'.
<H3>tuxkart.cxx</H3>
tuxkart_main() finds the configuration files, loads up the selected
track, initialises the sound system, sets up the simple GUI used
for the menu bar, loads up the player's kart models, the collectibles,
and the projectiles then drops into tuxKartMainLoop()
where the game proper is run.
<p>
tuxKartMainLoop() - is an infinite loop that updates
the collectibles, the missiles,
the players...then it tells the graphics, gui and sound subsystems
to update themselves - swaps the buffers and goes around again.
<p>
Each of those things that tuxKartMainLoop updates is a separate
C++ class - and most are in their own source files:
<p>
<H3>Vehicle Classes in Driver.h, Driver.cxx, KartDriver.cxx, PlayerDriver.cxx,
AutoDriver.cxx, Traffic.cxx, and Projectile.cxx:</H3>
There is a class heirarchy of derived objects that
move around on the race track in one way or another.
<pre>

class Driver                      -- Any object that moves around the track.
  |
  +-- class Projectile            -- A driver for missiles and such like.
  |
  +-- class KartDriver            -- A driver for any goKart.
      |
      +-- class AutoKartDriver    -- A goKart driven by AI.
      |
      +-- class PlayerKartDriver  -- A goKart driven by the player.
      |
      +-- class NetWorkKartDriver -- A goKart driven from the network
      |                              (not operational yet).
      +-- class TrafficDriver     -- Intended for other vehicles that are not
                                     competing as players (not used at present).

</pre>
<H3>In Explosion.h and Explosion.cxx:</H3>
<pre>
class Explosion
</pre>
<H3>Collectibles in Herring.h and Herring.cxx</H3>
(Could have a more meaningful filename!)
<pre>

class Herring      -- A collectible herring model + animation
                      this is pointed at by multiple HerringInstance's.

class Shadow       -- The shadow of a spinning herring, etc.

class ActiveThingInstance    -- An instance of some object that a kart can
  |                             collide with and which will make it go faster
  |                             or explode or collect something.
  |
  +-- class HerringInstance  -- A specific herring.

</pre>

<H3>Track Centerline data in Track.h and Track.cxx</H3>
<pre>

class Track    -- A convenience class to represent an object's position
                  in "Track Space" - and to convert track space to
                  3D space and back again.

</pre>
 Aside:  I should explain the concept of 'Track Space'....
<p>
    Track space is a 'coordinate system' represented by a distance
    along the 'drive line' (remember 'data/{trackname}.drv'?),
    and a lateral offset from the drive line (how far away from the
    centerline of the track are you?).  }

<H3>The GUI in gui.h and gui.cxx:</H3>
The GUI system is responsible for reading the
mouse, keyboard and joystick - and also for setting up and maintaining
the on-screen menu.
<pre>

class GUI

</pre>

<H3>3D Graphics in gfx.h and gfx.cxx:</H3>
The 3D graphics system is responsible for
rendering the 3D scene.  It manages the fog, lighting, etc.  There
isn't much code here because it's all in the PLIB scene graph library.
<pre>

class GFX

</pre>

<H3>Other files:</H3>
<TABLE border="1">
<TR>
<TD>
isect.h<br>isect.cxx 
</TD>
<TD>
                     Deals with intersection testing - collisions
                     between Karts and terrain - figuring out the
                     height of things...that kind of stuff.
</TR>
</TD>

<TR>
<TD>
guNet.h<br>guNet.cxx 
</TD>
<TD>
                     Network code (non-functional).
</TR>
</TD>

<TR>
<TD>
loader.h<br>loader.cxx 
</TD>
<TD>
                     The code to parse the {trackname}.loc file,
                     to load the 3D models, etc.
</TR>
</TD>

<TR>
<TD>
material.h<br>material.cxx 
</TD>
<TD>
                     The '.ac' file format doesn't tell you
                     everything you need to know about a polygon
                     (eg it's coefficient of friction) - and it's
                     convenient to be able to add that data somehow.
                     There is a table that recognises certain textures
                     as 'special' and sets their
                     properties up particularly.  Unrecognised
                     'materials' are defaulted.  This table is read
                     from 'data/materials.dat' on startup.
</TR>
</TD>

<TR>
<TD>
sound.h<br>sound.cxx 
</TD>
<TD>
                     The sound system.  Uses PLIB's sound library
                     to play music and sound effects.
</TR>
</TD>

<TR>
<TD>
status.h<br>status.cxx 
</TD>
<TD>
                     Manages status text on the screen. Help
                     screens, 'about' screen, timing, speedometer,
                     GameOver and 'WrongWay' signs.
</TR>
</TD>

<TR>
<TD>
utils.h<br>utils.cxx 
</TD>
<TD>
                     Some handy math functions.
</TD>
</TR>
</TABLE>

<H1>The Models:</H1>

These are generally clearly named, quite a few of the models are
there from old versions, experiments, etc - don't be suprised if
some of them are never used.

</body>
</html>

